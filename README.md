[![NuGet Version](https://img.shields.io/nuget/v/Atulin.NpgsqlSourceGenerator?style=for-the-badge)](https://www.nuget.org/packages/Atulin.NpgSqlSourceGenerator/)
![NuGet Downloads](https://img.shields.io/nuget/dt/Atulin.NpgsqlSourceGenerator?style=for-the-badge)
![GitHub Actions Workflow Status](https://img.shields.io/github/actions/workflow/status/Atulin/NpgsqlSourceGenerators/nuget.yml?style=for-the-badge)

# Npgsql Source Generators

Registering all enums one by one is tedious. Use this.

## Usage

```cs
namespace MyCoolApp;

[PostgresEnum]
public enum Status {
    Completed,
    InProgress,
    Started,
    Queued
}

[PostgresEnum(Name = "process_priority")]
public enum Priority {
    High,
    Medium,
    Low
}
```

will generate the following code:

```cs
// <auto-generated/>
#nullable enable
using Npgsql;
using Microsoft.EntityFrameworkCore;
       
namespace NpgSqlGenerators;

internal static class PostgresEnumHelpers
{
    /// <summary>
    /// Calls <see cref="Npgsql.NpgsqlDataSourceBuilder.MapEnum{T}"/> on selected enums
    /// </summary>
    public static NpgsqlDataSourceBuilder MapPostgresEnums(this NpgsqlDataSourceBuilder builder)
    {
        builder.MapEnum<MyCoolApp.Status>();
        builder.MapEnum<MyCoolApp.Priority>(pgName: "process_priority");
        return builder;
    }

    /// <summary>
    /// Calls <see cref="Microsoft.EntityFrameworkCore.NpgsqlModelBuilderExtensions.HasPostgresEnum{T}"/> on selected enums
    /// </summary>
    public static void RegisterPostgresEnums(this ModelBuilder builder)
    {
        builder.HasPostgresEnum<MyCoolApp.Status>();
        builder.HasPostgresEnum<MyCoolApp.Priority>(name: "process_priority");
    }
}
```

which can be used, for example, like so:

```cs
var source = new NpgsqlDataSourceBuilder(connectionString).npgSourceBuilder
    .MapPostgresEnums()
    .Build();
services.AddDbContext<ApplicationDbContext>(options => options.UseNpgsql(source));
```
```cs
public class MyDbContext : DbContext
{
    protected override void OnModelCreating(ModelBuilder builder)
    {
        base.OnModelCreating(builder);
        builder.RegisterPostgresEnums();
    }    
}
```
